@model PagedList.IPagedList<RegistroVisitantes.Models.INFOVISITA>
@using PagedList;
@using PagedList.Mvc;

@{
    ViewBag.Title = "Crear reportes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <h1><strong>Crear reportes</strong></h1>
    <hr />
    <div class="row">
        <div class="col-lg-12" id="resPanel">
            <div class="panel panel-default" id="panelResultados">
                <div class="panel-heading">
                    <span style="font-size: 30px;"><strong>Resultados:</strong></span>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered" id="tablaResultados">
                            <thead>
                                <tr>
                                    @if (ViewBag.col1 == true)
                                    {
                                        <th>Compañía</th>
                                    }
                                    @if (ViewBag.col2 == true)
                                    {
                                        <th>Estación</th>
                                    }
                                    @if (ViewBag.col3 == true)
                                    {
                                        <th>Reservación</th>
                                    }
                                    @if (ViewBag.col4 == true)
                                    {
                                        <th>Fecha entrada</th>
                                    }
                                    @if (ViewBag.col5 == true)
                                    {
                                        <th>Fecha salida</th>
                                    }
                                    @if (ViewBag.col6 == true)
                                    {
                                        <th>Tipo Visitante</th>
                                    }
                                    @if (ViewBag.col7 == true)
                                    {
                                        <th>Nacionalidad</th>
                                    }
                                    @if (ViewBag.col8 == true)
                                    {
                                        <th>Nombre Completo</th>
                                    }
                                    @if (ViewBag.col9 == true)
                                    {
                                        <th>Correo electrónico</th>
                                    }
                                </tr>
                            </thead>
                            <tbody>

                                @foreach (var item in Model)
                                {
                                    <tr>
                                        @if (ViewBag.col1 == true)
                                        {
                                            <td align="center">
                                                @if (item.RESERVACION.ANFITRIONA == "01")
                                                { <p>OET</p> }
                                                else
                                                { <p>ESINTRO</p>}
                                            </td>
                                        }
                                        @if (ViewBag.col2 == true)
                                        {
                                            <td>
                                                @Html.DisplayFor(modelItem => item.RESERVACION.ESTACIONI.SIGLAS)
                                            </td>
                                        }
                                        @if (ViewBag.col3 == true)
                                        {
                                            <td>
                                                @(item.RESERVACION.NUMERO)
                                            </td>
                                        }
                                        @if (ViewBag.col4 == true)
                                        {
                                            <td>
                                                @(item.RESERVACION.ENTRA)
                                            </td>
                                        }
                                        @if (ViewBag.col5 == true)
                                        {
                                            <td>
                                                @(item.RESERVACION.SALE)
                                            </td>
                                        }
                                        @if (ViewBag.col6 == true)
                                        {
                                            <td>
                                                @(item.PERSONA.ROL)
                                            </td>
                                        }
                                        @if (ViewBag.col7 == true)
                                        {
                                            <td>
                                                @(item.PERSONA.NACIONALIDAD)
                                            </td>
                                        }
                                        @if (ViewBag.col8 == true)
                                        {
                                            <td>
                                                @(item.PERSONA.NOMBRE) @(item.PERSONA.APELLIDO)
                                            </td>
                                        }
                                        @if (ViewBag.col9 == true)
                                        {
                                            <td>
                                                <a href="mailto:@(item.PERSONA.EMAIL)">@(item.PERSONA.EMAIL)</a>
                                            </td>
                                        }
                                    </tr>
                                }
                                @if (Model.Count < 5)
                                {
                                    for (int i = 5 - Model.Count; i > 0; i--)
                                    {
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <br />
            Página @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) de @Model.PageCount
            @Html.PagedListPager(Model, Pagina => Url.Action("Detalles",
        new
        {
            Pagina,
            FECHADESDE = ViewBag.FECHADESDE,
            FECHAHASTA = ViewBag.FECHAHASTA,
            ANFITRIONA = ViewBag.ANFITRIONA,
            ESTACION = ViewBag.ESTACION,
            TIPO = ViewBag.TIPO,
            NACIONALIDAD = ViewBag.NACIONALIDAD,
            col1 = ViewBag.col1,
            col2 = ViewBag.col2,
            col3 = ViewBag.col3,
            col4 = ViewBag.col4,
            col5 = ViewBag.col5,
            col6 = ViewBag.col6,
            col7 = ViewBag.col7,
            col8 = ViewBag.col8,
            col9 = ViewBag.col9
        }))
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span style="font-size: 30px;"><strong>Totales:</strong></span>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Compañía</th>
                                        <th>Número de reservaciones</th>
                                        <th>Número de visitantes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>OET</td>
                                        <td style="text-align:center">@ViewBag.totalReservOET</td>
                                        <td style="text-align:center">@ViewBag.totalVisitOET</td>
                                    </tr>
                                    <tr>
                                        <td>ESINTRO</td>
                                        <td style="text-align:center">@ViewBag.totalReservESINTRO</td>
                                        <td style="text-align:center">@ViewBag.totalVisitESINTRO</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td style="text-align:center"><strong>@ViewBag.totalReservInstitucion</strong></td>
                                        <td style="text-align:center"><strong>@ViewBag.totalVisitInstitucion</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Estación</th>
                                        <th>Número de reservaciones</th>
                                        <th>Número de visitantes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>La Selva</td>
                                        <td style="text-align:center">@ViewBag.totalReservLS</td>
                                        <td style="text-align:center">@ViewBag.totalVisitLS</td>
                                    </tr>
                                    <tr>
                                        <td>Palo Verde</td>
                                        <td style="text-align:center">@ViewBag.totalReservPV</td>
                                        <td style="text-align:center">@ViewBag.totalVisitPV</td>
                                    </tr>
                                    <tr>
                                        <td>Las Cruces</td>
                                        <td style="text-align:center">@ViewBag.totalReservLC</td>
                                        <td style="text-align:center">@ViewBag.totalVisitLC</td>
                                    </tr>
                                    <tr>
                                        <td>Central</td>
                                        <td style="text-align:center">@ViewBag.totalReservCRO</td>
                                        <td style="text-align:center">@ViewBag.totalVisitCRO</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td style="text-align:center"><strong>@ViewBag.totalReservEstacion</strong></td>
                                        <td style="text-align:center"><strong>@ViewBag.totalVisitEstacion</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            <button class="btn btn-success">Imprimir</button>
            @Html.ActionLink("Exportar", "Download", "Reportes", new { @class = "btn btn-success" })
        </div>
    </div>
    <div class="row" style="margin-bottom: 100px;">
        <div class="col-lg-8 col-lg-offset-2"> </div>
    </div>
</div>

@section Scripts{

    <script type="text/javascript">
        $(document).ready(function () {

            $("#FECHADESDE").datepicker({
                dateFormat: 'dd/mm/yy',
                showOn: "button",
                onSelect: function (date) {
                    var dt1 = $('#FECHADESDE').datepicker('getDate');
                    var dt2 = $('#FECHAHASTA').datepicker('getDate');
                    if (dt2 <= dt1) {
                        dt1.setDate(dt1.getDate() + 1);
                        $('#FECHAHASTA').datepicker('setDate', dt1);
                    } else {
                        dt1.setDate(dt1.getDate() + 1);
                    }
                    $('#FECHAHASTA').datepicker('option', 'minDate', dt1);
                }
            });
            $('#FECHAHASTA').datepicker({
                dateFormat: 'dd/mm/yy',
                showOn: "button"
            });
            var date2 = $('#FECHADESDE').datepicker('getDate');
            $('#FECHAHASTA').datepicker('option', 'minDate', date2);
        });
    </script>
}